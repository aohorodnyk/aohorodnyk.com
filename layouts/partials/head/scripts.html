{{- $js := resources.Get "silicon/js/main.js" -}}
{{- $js = $js | js.Build -}}

{{- $jsSlice := slice $js -}}

{{- /* Include libraries */ -}}
{{- $jsBundle := slice -}}
{{- $jsScript := resources.Get "node_modules/bootstrap/dist/js/bootstrap.bundle.min.js" -}}
{{- $jsBundle = $jsBundle | append $jsScript -}}
{{- $jsScript = resources.Get "node_modules/smooth-scroll/dist/smooth-scroll.polyfills.min.js" -}}
{{- $jsBundle = $jsBundle | append $jsScript -}}
{{- $jsScript = resources.Get "node_modules/rellax/rellax.min.js" -}}
{{- $jsBundle = $jsBundle | append $jsScript -}}
{{- $jsScript = resources.Get "node_modules/@lottiefiles/lottie-player/dist/lottie-player.js" -}}
{{- $jsBundle = $jsBundle | append $jsScript -}}
{{- $jsScript = resources.Get "node_modules/swiper/swiper-bundle.min.js" -}}
{{- $jsBundle = $jsBundle | append $jsScript -}}

{{- $jsSlice = $jsBundle | append $jsSlice -}}

{{- /* Calculate hash */ -}}
{{- $scriptsHashSource := $jsSlice | resources.Concat "/tmp/fingerprint_main_js.js" | resources.Minify | resources.Fingerprint "sha512" -}}
{{- $scriptsHash := md5 $scriptsHashSource.Data.Integrity -}}

{{- $buildName := "/main.js" -}}
{{- if eq hugo.Environment "production" -}}
  {{- /* Name js file on production as {hash}.js */ -}}
  {{- $buildName = print $scriptsHash ".js" -}}
{{- end -}}
{{- $script := $jsSlice | resources.Concat $buildName -}}

{{- /* Production preparation */ -}}
{{- if eq hugo.Environment "production" -}}
  {{- $script = $script | resources.Minify -}}
{{- end -}}

<script type="text/javascript" src="{{ $script.RelPermalink }}" crossorigin="anonymous" async ></script>
